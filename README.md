# terraui

A beautiful, interactive terminal UI for reviewing Terraform plans and watching applies. Inspired by Terraform Cloud's visual interface, but right in your terminal.

## Why terraui?

Reviewing Terraform plans in the terminal can be overwhelming, especially with large infrastructure changes. `terraui` transforms the wall of text into an organized, collapsible, color-coded view that makes it easy to:

- **Quickly identify what's changing** - Color-coded actions (create, update, destroy, replace, import).
- **Focus on what matters** - Collapse unchanged resources, expand only what you need.
- **Navigate large plans** - Scroll through hundreds of changes with keyboard or mouse.
- **Review with confidence** - See exactly what will happen before you apply.
- **Interactive Applies** - Watch logs stream in real-time and approve applies directly from the UI.

## Features

- **Catppuccin Mocha Theme** - Modern, beautiful color palette (Vibrant Red, Green, Mauve, Sky).
- **Two Rendering Modes** - Switch between **Dashboard** (subtle, Terraform-like) and **HighContrast** (vivid colors) with `m`.
- **Rich Error Formatting** - Bold file locations, underlined markers (`^`, `~`), and colored diagnostics matching Terraform CLI.
- **Collapsible resource blocks** - Expand/collapse individual resources or all at once.
- **Dual Views** - Automatically switches between **Plan View** (structured changes) and **Log View** (raw output like `init` or `apply` progress).
- **Smart Text Wrapping** - Long lines wrap intelligently with preserved indentation.
- **Streaming & Interactive** - Works with `terraform init` and `terraform apply`.
- **Interactive Wrapper** - Run as a wrapper (`terraui terraform apply`) to handle "yes" confirmation prompts interactively.
- **Log Auto-scrolling** - Automatically follows the output stream like `tail -f`.
- **Vim-style keybindings** - `j/k`, `Ctrl+u/d`, `g/G` for power users.
- **Mouse support** - Click to select, scroll wheel to navigate.

## How it looks

### Dashboard (Normal) Mode

Terraform Apply
![Terraform Apply Normal Mode](https://github.com/user-attachments/assets/1e0cf290-bc0c-4136-bf98-f38275e99c1b)
Terraform Plan
![Terraform Plan Normal Mode](https://github.com/user-attachments/assets/ed5d24fe-6847-4d0e-8e6c-b9466d77fb21)

### High Contrast Mode

Terraform Apply
![Terraui Apply High Contrast Mode](https://github.com/user-attachments/assets/eeef52c0-8dd6-4907-a71d-161a6d046c35)
Terraform Plan
![Terraui Plan High Contrast Mode](https://github.com/user-attachments/assets/f01ef86c-ab11-476e-be20-ea3eb900b30c)

## Installation

### From source

```bash
# Clone the repository
git clone https://github.com/davidnbr/terraui.git
cd terraui

# Build
go build -o terraui .

# Optionally, move to your PATH
sudo mv terraui /usr/local/bin/
```

### Requirements

- Go 1.21 or later

## Usage

### 1. Pipe Mode (Plan Review)

Best for reviewing plans generated by CI/CD or local runs.

> **Important:** Terraform sends error messages to **stderr**, not stdout. If you pipe without stderr redirection, terraui will receive zero bytes and display a blank screen.

```bash
# Standard usage (REQUIRED: include 2>&1 to capture errors)
terraform plan 2>&1 | terraui

# Without stderr redirection (NOT RECOMMENDED - errors will be lost)
terraform plan | terraui
```

**Why `2>&1` is required:** When Terraform encounters errors, they are written to stderr. If you pipe only stdout (`terraform plan | terraui`), terraui receives no input and will display a warning. The `2>&1` redirection merges stderr into stdout so terraui can display both the plan and any errors.

### 2. Interactive Mode (Wrapper)

Best for running `terraform apply` or `init` locally. This allows you to type "yes" when prompted.

```bash
# Wraps the command in a PTY (pseudo-terminal)
terraui terraform apply
```

In interactive mode:

1. Review the plan using navigation keys.
2. When the **"Enter a value:"** prompt appears (pinned at the bottom), press **`i`** to enter **Input Mode**.
3. Type `yes` and press `Enter`.
4. The view will automatically switch to **Log View** and auto-scroll to show the creation progress.

## Controls

### General & Navigation

| Key               | Action                                           |
| ----------------- | ------------------------------------------------ |
| `↑` / `k`         | Move cursor up                                   |
| `↓` / `j`         | Move cursor down                                 |
| `Enter` / `Space` | Expand/collapse resource (in Plan View)          |
| `Ctrl+u`          | Scroll up half page                              |
| `Ctrl+d`          | Scroll down half page                            |
| `PgUp` / `PgDn`   | Scroll up/down half page                         |
| `g` / `Home`      | Go to top                                        |
| `G` / `End`       | Go to bottom                                     |
| `e`               | Expand all resources                             |
| `c`               | Collapse all resources                           |
| `L`               | Toggle between **Plan** and **Log** views        |
| `m`               | Toggle rendering mode (Dashboard / HighContrast) |
| `q` / `Ctrl+c`    | Quit                                             |

### Input Mode (Interactive Wrapper)

| Key         | Action                                        |
| ----------- | --------------------------------------------- |
| `i`         | Enter **Input Mode** (when prompt is visible) |
| `Esc`       | Exit Input Mode (return to navigation)        |
| `Type text` | Type into the local buffer (e.g., "yes")      |
| `Enter`     | Send typed text to Terraform                  |

### Mouse

| Action                  | Behavior                   |
| ----------------------- | -------------------------- |
| Scroll wheel up         | Move cursor up (3 lines)   |
| Scroll wheel down       | Move cursor down (3 lines) |
| Left click              | Select line                |
| Click selected resource | Expand/collapse it         |

## Color Coding

| Symbol | Color  | Meaning                                      |
| ------ | ------ | -------------------------------------------- |
| `+`    | Green  | Resource will be created                     |
| `-`    | Red    | Resource will be destroyed                   |
| `~`    | Yellow | Resource will be updated in-place            |
| `±`    | Mauve  | Resource must be replaced (destroy + create) |
| `←`    | Sky    | Resource will be imported                    |

Attributes within resources are also color-coded:

- **Green** - Attribute being added (`+ attribute = value`)
- **Red** - Attribute being removed (`- attribute = value`)
- **Yellow** - Attribute being changed (`~ attribute = old -> new`)
- **Dim gray** - Unchanged attributes (shown for context)

## Rendering Modes

Toggle between modes with `m`:

| Mode             | Description                                                                                                                                             |
| ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Dashboard**    | Subtle styling that mimics standard Terraform CLI output. Colors are applied to symbols and prefixes only, keeping the overall look clean and familiar. |
| **HighContrast** | Vivid colors applied to entire lines for maximum visibility. Useful for accessibility or when reviewing in bright environments.                         |

Both modes use the Catppuccin Mocha color palette and support:

- **Bold** file location markers (e.g., `on main.tf line 7:`)
- **Underlined** error markers (`^`, `~~~~`)
- Colored structural guides (`│`, `├`, `─`)

## Supported Terraform Versions

`terraui` works with:

- Terraform CLI (all recent versions)
- OpenTofu
- HCP Terraform / Terraform Cloud (remote plan output)
- Terraform Enterprise

## How It Works

`terraui` parses the human-readable Terraform plan output by:

1. Detecting resource change headers (`# resource.name will be created/updated/destroyed`)
2. Capturing the resource block and all its attributes
3. Parsing diagnostic blocks (errors/warnings) with semantic formatting preservation
4. Sanitizing ANSI codes while preserving bold/underline formatting from Terraform
5. Running a PTY wrapper (via `github.com/creack/pty`) for interactive commands
6. Rendering an interactive TUI using [Bubble Tea](https://github.com/charmbracelet/bubbletea)
7. Wrapping long lines intelligently with preserved indentation

## Contributing

Contributions are welcome! Feel free to:

- Report bugs
- Suggest features
- Submit pull requests

## License

MIT License - see [LICENSE](LICENSE) for details.

## Acknowledgments

Built with:

- [Bubble Tea](https://github.com/charmbracelet/bubbletea) - TUI framework
- [Lip Gloss](https://github.com/charmbracelet/lipgloss) - Style definitions
- [creack/pty](https://github.com/creack/pty) - PTY interface for Go

Inspired by the Terraform Cloud plan UI.
